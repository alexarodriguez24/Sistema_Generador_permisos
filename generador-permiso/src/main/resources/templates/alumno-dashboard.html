<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Alumno - ITCA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .card-stat {
            transition: transform 0.3s;
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .card-stat:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .quick-action-card {
            transition: all 0.3s;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .quick-action-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .recent-permits {
            max-height: 400px;
            overflow-y: auto;
        }
        .status-badge {
            font-size: 0.75em;
        }
        .welcome-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" href="#">
            <i class="fas fa-graduation-cap"></i> ITCA - Dashboard Alumno
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link active" th:href="@{/permisos/dashboard}">
                <i class="fas fa-home"></i> Inicio
            </a>
            <a class="nav-link" th:href="@{/permisos/solicitar}">
                <i class="fas fa-plus-circle"></i> Solicitar Permiso
            </a>
            <a class="nav-link" th:href="@{/permisos/mis-permisos}">
                <i class="fas fa-history"></i> Mis Permisos
            </a>
            <a class="nav-link" th:href="@{/logout}">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
            </a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <!-- Encabezado con información del alumno -->
    <div class="welcome-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 th:if="${alumno != null}" class="display-6 fw-bold mb-2">
                    <i class="fas fa-user-graduate"></i>
                    Bienvenido, <span th:text="${alumno.nombre + ' ' + alumno.apellido}"></span>
                </h1>
                <h1 th:if="${alumno == null and alumnoNombre != null}" class="display-6 fw-bold mb-2">
                    <i class="fas fa-user-graduate"></i>
                    Bienvenido, <span th:text="${alumnoNombre}"></span>
                </h1>
                <h1 th:if="${alumno == null and alumnoNombre == null}" class="display-6 fw-bold mb-2">
                    <i class="fas fa-user-graduate"></i>
                    Bienvenido, Alumno
                </h1>
                <p class="mb-0">
                    <i class="fas fa-calendar-alt"></i>
                    Hoy es <span th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy')}"></span> |
                    Sistema de Gestión de Permisos Estudiantiles
                </p>
            </div>
            <div class="col-md-4 text-end">
                <div th:if="${alumno != null}" class="bg-light text-dark rounded p-3">
                    <strong><i class="fas fa-id-card"></i> Carnet:</strong>
                    <span th:text="${alumno.carnet}" class="fw-bold"></span>
                    <br>
                    <span th:if="${alumno.carrera != null}">
                        <strong><i class="fas fa-book"></i> Carrera:</strong>
                        <span th:text="${alumno.carrera.nombre}"></span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Mensajes de éxito/error -->
    <div th:if="${param.success}" class="alert alert-success alert-dismissible fade show">
        <i class="fas fa-check-circle"></i>
        <strong>¡Éxito!</strong> Solicitud de permiso enviada correctamente.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show">
        <i class="fas fa-exclamation-circle"></i>
        <strong>Error:</strong> Ocurrió un problema al procesar la solicitud.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Estadísticas -->
    <div class="row mt-4">
        <div class="col-md-3 mb-3">
            <div class="card card-stat text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body text-center">
                    <i class="fas fa-file-alt fa-3x mb-3"></i>
                    <h2 th:text="${totalPermisos}" class="display-6 fw-bold">0</h2>
                    <p class="mb-0">Total de Permisos</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card card-stat bg-success text-white">
                <div class="card-body text-center">
                    <i class="fas fa-check-circle fa-3x mb-3"></i>
                    <h2 th:text="${permisosAprobados}" class="display-6 fw-bold">0</h2>
                    <p class="mb-0">Aprobados</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card card-stat bg-warning text-white">
                <div class="card-body text-center">
                    <i class="fas fa-clock fa-3x mb-3"></i>
                    <h2 th:text="${permisosPendientes}" class="display-6 fw-bold">0</h2>
                    <p class="mb-0">Pendientes</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card card-stat bg-danger text-white">
                <div class="card-body text-center">
                    <i class="fas fa-times-circle fa-3x mb-3"></i>
                    <h2 th:text="${permisosRechazados}" class="display-6 fw-bold">0</h2>
                    <p class="mb-0">Rechazados</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Acciones Rápidas y Contenido Principal -->
    <div class="row mt-4">
        <!-- Acciones Rápidas -->
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-bolt"></i> Acciones Rápidas</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-3">
                        <a th:href="@{/permisos/solicitar}" class="btn btn-primary btn-lg quick-action-card py-3">
                            <i class="fas fa-plus-circle fa-2x mb-2"></i><br>
                            Solicitar Nuevo Permiso
                        </a>
                        <a th:href="@{/permisos/mis-permisos}" class="btn btn-info btn-lg quick-action-card py-3">
                            <i class="fas fa-history fa-2x mb-2"></i><br>
                            Ver Historial Completo
                        </a>

                    </div>
                </div>
            </div>

            <!-- Información del Sistema -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-info-circle"></i> Información del Sistema</h5>
                </div>
                <div class="card-body">
                    <h6><i class="fas fa-list-alt"></i> Tipos de Permisos Disponibles:</h6>
                    <ul class="list-unstyled ms-3">
                        <li><i class="fas fa-stethoscope text-primary me-2"></i> Incapacidad Médica</li>
                        <li><i class="fas fa-heart text-danger me-2"></i> Duelo Familiar</li>
                        <li><i class="fas fa-user text-warning me-2"></i> Asuntos Personales</li>
                        <li><i class="fas fa-briefcase text-success me-2"></i> Labor/Práctica</li>
                        <li><i class="fas fa-building text-info me-2"></i> Trámites Oficina</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Últimos Permisos -->
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-clock"></i> Permisos Recientes</h5>
                    <a th:href="@{/permisos/mis-permisos}" class="btn btn-sm btn-light">
                        Ver Todos <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                <div class="card-body recent-permits">
                    <div th:if="${misPermisos != null and !misPermisos.isEmpty()}">
                        <div th:each="permiso : ${misPermisos}"
                             th:if="${#lists.size(misPermisos) <= 5 or #iteration.index < 5}"
                             class="border-bottom pb-3 mb-3">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="mb-1 text-primary" th:text="${permiso.tipoPermiso != null ? permiso.tipoPermiso.nombre : 'Sin tipo'}">
                                        Tipo de Permiso
                                    </h6>
                                    <small class="text-muted">
                                        <i class="fas fa-calendar"></i>
                                        Solicitud: <span th:text="${#temporals.format(permiso.fechaSolicitud, 'dd/MM/yyyy HH:mm')}"></span>
                                    </small>
                                    <br>
                                    <small class="text-muted">
                                        <i class="fas fa-calendar-check"></i>
                                        Permiso: <span th:text="${#temporals.format(permiso.fechaInicioPermiso, 'dd/MM/yyyy')}"></span>
                                        al <span th:text="${#temporals.format(permiso.fechaFinPermiso, 'dd/MM/yyyy')}"></span>
                                    </small>
                                    <br>
                                    <small class="text-truncate">
                                        <strong>Motivo:</strong>
                                        <span th:text="${#strings.abbreviate(permiso.motivo, 60)}"></span>
                                    </small>
                                </div>
                                <div class="text-end ms-3">
                                    <span th:switch="${permiso.estado}" class="badge status-badge fs-6">
                                        <span th:case="PENDIENTE" class="badge bg-warning">PENDIENTE</span>
                                        <span th:case="APROBADO" class="badge bg-success">APROBADO</span>
                                        <span th:case="RECHAZADO" class="badge bg-danger">RECHAZADO</span>
                                        <span th:case="EXPIRADO" class="badge bg-secondary">EXPIRADO</span>
                                        <span th:case="IMPRESO" class="badge bg-info">IMPRESO</span>
                                    </span>
                                    <br>
                                    <div class="mt-2">
                                        <a th:href="@{/permisos/detalle/{id}(id=${permiso.id})}"
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye"></i> Ver
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div th:if="${misPermisos == null or misPermisos.isEmpty()}" class="text-center text-muted py-5">
                        <i class="fas fa-inbox fa-4x mb-3 opacity-50"></i>
                        <h5>No hay permisos solicitados aún</h5>
                        <p class="mb-3">Comienza solicitando tu primer permiso</p>
                        <a th:href="@{/permisos/solicitar}" class="btn btn-primary btn-lg">
                            <i class="fas fa-plus"></i> Solicitar Primer Permiso
                        </a>
                    </div>
                </div>
            </div>

            <!-- Guía de Estados -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-tasks"></i> Guía de Estados</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-3">
                                <span class="badge bg-warning me-3 fs-6">PENDIENTE</span>
                                <small>En revisión por coordinación</small>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <span class="badge bg-success me-3 fs-6">APROBADO</span>
                                <small>Permiso autorizado y válido</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-3">
                                <span class="badge bg-danger me-3 fs-6">RECHAZADO</span>
                                <small>Permiso no autorizado</small>
                            </div>
                            <div class="d-flex align-items-center mb-3">
                                <span class="badge bg-info me-3 fs-6">IMPRESO</span>
                                <small>Comprobante generado</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="bg-dark text-white text-center py-4 mt-5">
    <div class="container">
        <p class="mb-0">
            <i class="fas fa-copyright"></i> 2025 ITCA - Sistema de Gestión de Permisos.
            <span class="text-muted">Versión 1.0 | Desarrollado para ITCA FEPADE</span>
        </p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Auto-ocultar alertas después de 5 segundos
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            var alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                var bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);

        // Actualizar estadísticas cada 30 segundos (opcional)
        setInterval(function() {
            // Aquí podrías agregar una actualización AJAX en el futuro
            console.log('Dashboard actualizado');
        }, 30000);
    });

    // Función para mostrar notificaciones
    function showNotification(message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.welcome-header'));

        setTimeout(() => {
            alertDiv.remove();
        }, 5000);
    }
</script>
</body>
</html>